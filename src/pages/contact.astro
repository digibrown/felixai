---
import Base from '../layouts/Base.astro';
import Hero from '../components/Hero.astro';

// Configure the email address to receive messages
const EMAIL_TO = 'contact@felix.ai';
---

<Base title="Contact — Felix.AI">
  <Hero title="Contact" subtitle="Get in touch with Felix.AI." />
  <section class="contact-section" aria-labelledby="contact-heading">
    <div class="contact-card">
      <h2 id="contact-heading">Send us a message</h2>
      <p class="intro">Have a question, partnership idea, or project in mind? Fill out the form and we’ll get back to you.</p>

      <form id="contact-form" action={`mailto:${EMAIL_TO}`} method="post" enctype="text/plain" novalidate>
        <div class="grid">
          <div class="field">
            <label for="name">Name</label>
            <input id="name" name="name" type="text" autocomplete="name" required placeholder="Jane Doe" />
            <p class="hint" id="name-hint">Please enter your full name.</p>
          </div>
          <div class="field">
            <label for="email">Email</label>
            <input id="email" name="email" type="email" autocomplete="email" required placeholder="jane@company.com" />
            <p class="hint" id="email-hint">We’ll only use this to reply.</p>
          </div>
        </div>

        <div class="field">
          <label for="subject">Subject <span class="muted">(optional)</span></label>
          <input id="subject" name="subject" type="text" placeholder="How can we help?" />
        </div>

        <div class="field">
          <label for="message">Message</label>
          <textarea id="message" name="message" rows="6" required placeholder="Tell us a bit about your needs…"></textarea>
          <p class="hint" id="message-hint">Include timelines, budget, and goals if relevant.</p>
        </div>

        <!-- Honeypot for basic spam protection -->
        <div class="hp" aria-hidden="true">
          <label for="company">Company</label>
          <input id="company" name="company" type="text" tabindex="-1" autocomplete="off" />
        </div>

        <div class="actions">
          <button type="submit" class="btn primary">Send message</button>
          <a id="mailto-fallback" class="btn ghost" href={`mailto:${EMAIL_TO}`}>Email us directly</a>
        </div>

        <p id="form-status" class="status" role="status" aria-live="polite"></p>
      </form>
    </div>
  </section>

  <script is:inline>
    // Inject server value into client script safely
    const EMAIL_TO = {JSON.stringify(EMAIL_TO)};
    const form = document.getElementById('contact-form');
    const statusEl = document.getElementById('form-status');
    const fallback = document.getElementById('mailto-fallback');

    function setStatus(msg, type = 'info') {
      statusEl.textContent = msg;
      statusEl.dataset.type = type;
    }

    function encodeRFC3986(str) {
      return encodeURIComponent(str).replace(/[!'()*]/g, c => '%' + c.charCodeAt(0).toString(16));
    }

    form?.addEventListener('submit', (e) => {
      e.preventDefault();

      const fd = new FormData(form);
      // spam honeypot
      if ((fd.get('company') || '').toString().trim().length > 0) {
        setStatus('Submission blocked.');
        return;
      }

      const name = (fd.get('name') || '').toString().trim();
      const email = (fd.get('email') || '').toString().trim();
      const subject = (fd.get('subject') || '').toString().trim();
      const message = (fd.get('message') || '').toString().trim();

      // Basic client validation
      if (!name || !email || !message) {
        setStatus('Please complete required fields.', 'error');
        form.reportValidity?.();
        return;
      }

      const subj = subject || `Website contact from ${name}`;
      const bodyLines = [
        `Name: ${name}`,
        `Email: ${email}`,
        subject ? `Subject: ${subject}` : null,
        '',
        message
      ].filter(Boolean);

      const mailto = `mailto:${EMAIL_TO}?subject=${encodeRFC3986(subj)}&body=${encodeRFC3986(bodyLines.join('\n'))}`;

      // Update fallback link and attempt to open mail client
      fallback.setAttribute('href', mailto);
      setStatus('Opening your email client…');
      try {
        // Most reliable across browsers: programmatic click on anchor
        fallback.click();
      } catch (_) {
        try { window.location.assign(mailto); } catch { window.location.href = mailto; }
      }

      // Provide a visible fallback link
      setTimeout(() => {
        setStatus('If your email client did not open, click "Email us directly".', 'info');
      }, 800);
    });
  </script>

  <style>
    .contact-section {
      display: grid;
      place-items: center;
      padding: 2rem 1rem 4rem;
      background: color-mix(in srgb, Canvas 96%, transparent);
    }
    .contact-card {
      width: 100%;
      max-width: 820px;
      background: color-mix(in srgb, #000 8%, #fff 92%);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      padding: 1.5rem;
    }
    .contact-card h2 { margin: 0 0 .25rem; font-size: 1.75rem; }
    .intro { margin: 0 0 1rem; color: color-mix(in srgb, currentColor 72%, transparent); }

    form { display: grid; gap: 1rem; }
    .grid { display: grid; gap: 1rem; grid-template-columns: 1fr; }
    @media (min-width: 720px) { .grid { grid-template-columns: 1fr 1fr; } }

    .field { display: grid; gap: .375rem; }
    label { font-weight: 600; }
    .muted { font-weight: 400; color: color-mix(in srgb, currentColor 56%, transparent); }
    input, textarea { 
      font: inherit; color: inherit; background: transparent; 
      border: 1px solid color-mix(in srgb, currentColor 24%, transparent);
      border-radius: 10px; padding: .75rem .875rem; outline: none;
    }
    input:focus, textarea:focus { 
      border-color: color-mix(in srgb, #3b82f6 70%, currentColor 30%);
      box-shadow: 0 0 0 3px color-mix(in srgb, #3b82f6 18%, transparent);
    }
    .hint { margin: 0; font-size: .9rem; color: color-mix(in srgb, currentColor 52%, transparent); }
    .hp { position: absolute; left: -9999px; width: 1px; height: 1px; overflow: hidden; }

    .actions { display: flex; gap: .75rem; align-items: center; flex-wrap: wrap; }
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: .5ch; 
      text-decoration: none; padding: .75rem 1rem; border-radius: 10px; border: 1px solid transparent; cursor: pointer; }
    .btn.primary { background: #3b82f6; color: #fff; }
    .btn.primary:hover { filter: brightness(1.05); }
    .btn.ghost { background: transparent; border-color: color-mix(in srgb, currentColor 24%, transparent); }

    .status { margin: .25rem 0 0; min-height: 1.25rem; font-size: .95rem; }
    .status[data-type="error"] { color: #b00020; }
  </style>
</Base>
